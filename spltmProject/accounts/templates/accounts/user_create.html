{% extends "adminDashBoard.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Create User</h2>
  <form id="create-user-form" method="post" action="/api/users/create/">
    {% csrf_token %}
    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" class="form-control" id="email" name="email" required>
    </div>
    <div class="form-group">
      <label for="full_name">Full name</label>
      <input type="text" class="form-control" id="full_name" name="full_name" required>
    </div>
    <div class="form-group">
      <label for="password">Password</label>
      <input type="password" class="form-control" id="password" name="password" required>
    </div>
    <button type="submit" class="btn btn-primary">Create</button>
  </form>
</div>

{% endblock %}

  {% block extra_js %}
  <script src="/static/assets/js/customJs/util.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function(){
    const form = document.getElementById('create-user-form');
    form.addEventListener('submit', async function(e){
      e.preventDefault();

      const email = document.getElementById('email').value.trim();
      const full_name = document.getElementById('full_name').value.trim();
      const password = document.getElementById('password').value;

      if(!email || !full_name || !password){
        showAlert(false, 'All fields are required');
        return;
      }

      // Read CSRF token rendered by Django
      const csrfInput = document.getElementsByName('csrfmiddlewaretoken')[0];
      const csrftoken = csrfInput ? csrfInput.value : '';

      const payload = { email, full_name, password };

      try {
        const response = await fetch('/api/users/create/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken
          },
          body: JSON.stringify(payload)
        });

        const result = await handleResponse(response);
        // handleResponse shows error alerts; on success show success alert
        showAlert(true, result.message || 'User created successfully');
        // optionally redirect to users list
        window.location.href = '/account/users/ui/';
      } catch (err) {
        // handleResponse already shows alert on failure
        console.error('Create user failed', err);
      }
    });
  });
  </script>
  {% endblock %}
